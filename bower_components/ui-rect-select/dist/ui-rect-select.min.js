"use strict";angular.module("uiSelect",[]).directive("uiRectSelect",["$log","$parse",function(a,b){function c(a,b){var c=a.$root&&a.$root.$$phase;"$apply"==c||"$digest"==c?b&&a.$eval(b):b?a.$apply(b):a.$apply()}var d={selector:".photo",moveSelect:!0};return{restrict:"A",link:function(a,e,f){function g(a){if(n){a.preventDefault();var b=a.pageX-r,c=a.pageY-s,d=Math.abs(l-b),e=Math.abs(m-c);10>d&&10>e||(o.css({width:d,height:e}),l>=b&&c>=m?o.css({left:b}):m>=c&&b>=l?o.css({top:c}):m>c&&l>b&&o.css({left:b,top:c}),j.moveSelect&&h(a))}}function h(a){var d=(new Array,b(f.uiSelector||"selected").assign);angular.forEach(e.find(j.selector),function(b){b=angular.element(b);var e=b.scope(),f=i(o,b);if(1==f){return void c(e,function(){d(e,!0)})}else a.shiftKey||c(e,function(){d(e,!1)})})}function i(a,b){var c=a.offset().top,d=a.offset().left,e=b.offset().top,f=b.offset().left;return!(c+a.outerHeight()<e||c>e+b.outerHeight()||d+a.outerWidth()<f||d>f+b.outerWidth())}var j,k=a.$eval(f.uiRectSelect||"{}");j=angular.extend({},d,k),f.$observe("uiMoveSelect",function(a){j.moveSelect=a&&"true"==a});var l=0,m=0,n=!1,o=angular.element("<div class='ghost-select' ng-show='ghostSelectShow'><span></span></div>"),p=angular.element('<div id="grid"></div>').append(o);e.prepend(p);var q=angular.element("<div id='big-ghost' class='big-ghost' ng-show='bigGhostShow'></div>");e.append(q);var r=0,s=0;e.bind("mousedown",function(b){r=p.offset().left,s=p.offset().top;var c=b.pageX-r,d=b.pageY-s;a.bigGhostShow=!1,a.ghostSelectShow=!0,o.css({left:c,top:d}),l=c,m=d,n=!0}),angular.element(document).bind("mousemove",g),angular.element(document).bind("mouseup",function(b){if(n){n=!1;var c=Math.abs(l-b.pageX+r),d=Math.abs(m-b.pageY+s);10>c&&10>d||(h(b),a.ghostSelectShow=!1,o.width(0).height(0))}})}}}]);